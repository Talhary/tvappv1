<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Drama Selection with Video Player</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://vjs.zencdn.net/8.16.1/video-js.css" rel="stylesheet" />
    <link rel="stylesheet" type="text/css" href="https://use.fontawesome.com/releases/v5.0.6/css/all.css">
    <link
      rel="stylesheet"
      href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@20..48,100..700,0..1,-50..200"
    />
    <!-- <script src="https://cdn.plyr.io/3.7.8/plyr.js"></script> -->
    <!-- <link rel="stylesheet" href="https://cdn.plyr.io/3.7.8/plyr.css" /> -->
    <link
      rel="stylesheet"
      href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@24,400,0,0"
    />
    <style>
      .material-symbols-outlined {
        font-variation-settings: "FILL" 0, "wght" 400, "GRAD" 0, "opsz" 24;
      }
    </style>
    <style>
      body {
        background-image: url("https://static.vecteezy.com/system/resources/previews/008/968/741/large_2x/multi-layers-yellow-blue-dark-texture-3d-papercut-layers-in-gradient-banner-abstract-paper-cut-art-background-design-for-website-template-topography-map-concept-or-smooth-origami-paper-cut-vector.jpg");
        background-position: center;
        background-repeat: no-repeat;
        background-size: cover;
      }
      
      .btn:active {
        background-color: black;
        color: white;
      }
      .btn:focus {
        background-color: black;
        color: white;
        outline: none;
        box-shadow: none;
      }
      .buttoncontrols1 {
            display: inline-block;
            padding: 3px 5px;
            color: #FF1493;
            background: #FFFF00;
            border-radius: 3px;
            border: 1px solid #000000;
            margin: 0 2px;
        }
        @keyframes spin {
            0% {
                transform: rotate(0deg);
            }
            100% {
                transform: rotate(360deg);
            }
        }
        .spinner::after {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            border-radius: 50%;
            border: 4px solid transparent;
            border-top-color: currentColor;
            animation: spin 1s linear infinite;
        }
    </style>
  </head>

  <body
    class="bg-gray-900  text-white flex flex-col justify-start items-center min-h-screen"
  >
    <div class="relative"> 
    <div 
      class="z-10 w-[100vw] mx-auto fixed h-full max-w-xl  border border-black shadow"
    >
      <video
        playsinline
        controls
        id="vid1"
        preload='auto'
        height="300"
        class="video-js w-full max-w-xl mx-auto"
        poster="./images/MainBefore.webp"
        controls
        title="Video 01"
        
      >
        <source
          id="videoSrc"
          src="https://playertest.longtailvideo.com/adaptive/wowzaid3/playlist.m3u8"
          type="application/x-mpegURL"
          data-quality="hd"
        />
      </video>
      
      <div
        class="custom-controls py-2 text-xl bg-black flex gap-x-1 items-center flex-row justify-center"
      >
        <button class="move10b buttoncontrols1 text-sm">
          <i class="fas fa-fast-backward"></i> 10s
        </button>

        <button id="prevBtn" class=" buttoncontrols1 ">
          <span class="material-symbols-outlined"> arrow_back_ios </span>
        </button>
        <button id="fullS" class=" buttoncontrols1">
          <i class="fas fa-external-link-square-alt"></i>
                </button>
        <button id="playBtn" class=" buttoncontrols1 ">
          <i class="fas fa-play"></i>
                </button>
        <button id="pauseBtn" class=" buttoncontrols1">
          <i class="fas fa-pause"></i>
                </button>
        <button id="nextBtn" class="  buttoncontrols1">
          <span class="material-symbols-outlined"> arrow_forward_ios </span>
        </button>
        <button class="move10f buttoncontrols1 text-sm">
          10s <i class="fas fa-fast-forward"></i>        </button>
      </div>
      <div
        class="flex gap-x-1 items-center px-2 justify-start bg-[#49501d] h-20 w-full"
      >
        <div class="flex gap-x-1 pb-5">
          <div>
            <img
              src="./images/MainBefore.webp"
              class="rotate-[90deg] mt-5 max-w-10 object-contain rounded-full"
            />
          </div>
          
        </div>
        <div class="flex gap-x-2 items-center text-sm px-1 h-20 heading  w-full  justify-center">
          <div>
            <h1 class="text-[0.8rem]">Powered By Fungroup</h1>
            <input
              type="text"
              oninput="SearchText()"
              placeholder="Enter a Keyword for search"
              class="search-text px-2 py-0 my-1 text-black search-input rounded text-[0.7rem]"
            />
          </div>
          
        </div>
        
        <div class="flex flex-col w-full">
          <div class="select-item hidden">
            <h3 class="name ml-2 font-semibold"></h3>
            
          </div>
          <div class="btn-section   hidden mt-4  w-full flex justify-between ">
            <div class="gap-x-3">
              <select
              name="selectVideo"
              id="select-ep"
              class="mx-2 text-black px-3 "
            >
              <option value="op">Episode 1</option>
            </select>
            <button
              class="play-btn    bg-blue-800 focus:bg-white px-5 py-0 focus:text-black text-white text-md border-white border-[1px]"
            >
              Play
            </button>
            </div>
            <button class="text-red-700 font-semibold close-btn px-2 bg-white   mx-1 text-md">
              x
            </button>
          </div>
        </div>
      </div>
     
    </div>
    </div>
    <div
    class="z-0 section mt-[25rem]  flex gap-3 p-3 flex-wrap bg-[#342520] py-10 justify-center items-center w-[100vw] mx-auto "
  >  
  <div class="loading h-full text-white">
    <div class="spinner relative w-16 h-16 text-blue-500">
   </div>
</div>
</div>    
    <script src="https://vjs.zencdn.net/8.16.1/video.min.js"></script>
    <script>
        
      const player = videojs('vid1',{})
      
      function clearSelectOptions() {
        const selectElement = document.getElementById("select-ep");

        // Remove all options from the select element
        while (selectElement.options.length > 0) {
          selectElement.remove(0);
        }
      }

      const AddItem = (list)=>{
        list.forEach((item) => {
            const div = document.createElement("div");
            div.className =
              "playVideo  relative flex items-center p-1 bg-none border border-white border-[2px]   shadow-white justify-center min-w-20";
            div.setAttribute("data-id", item.id);
            div.innerHTML = `<div>
                    <img src="${item.imgsrc}" alt="${item.title}" class="object-contain w-[8rem]" />
                </div>
                <div class="absolute bottom-2 text-black text-center font-bold bg-white bg-opacity-60 w-fit px-1 rounded-md text-xl w-full">
                    ${item.title}
                </div>`;
            div.addEventListener("click", (e) => {
              const title = document.querySelector(".name");
              document.querySelectorAll(".playVideo").forEach((el) => {
                el.style.borderColor = "white";
              });
              e.currentTarget.style.borderColor = "red";
              title.textContent = item.title;
              const id = e.currentTarget.getAttribute("data-id");
              const episodes = list.find((item) => item.id == id).episodes;
              const SelectOption = document.getElementById("select-ep");
              document.querySelector(".heading").classList.add("hidden");
              document.querySelector(".select-item").classList.remove("hidden");
              document.querySelector(".btn-section").classList.remove("hidden");
              clearSelectOptions();
              episodes.forEach((episode, i) => {
                const option = document.createElement("option");
                option.value = episode;
                option.textContent = `Episode ${i + 1}`;
                SelectOption.appendChild(option);
              });
            });
            section.appendChild(div);
          });

      }

      const section = document.querySelector(".section");

       const link = 'https://sagheeronline7.000webhostapp.com/Talha.2drama.php'
       fetch(link).then(res=>res.json()).then((res)=>{
        document.querySelector('.loading').classList.add('hidden')
        list = res
        AddItem(res) })
      
      const Play = (src)=>{
        console.log(src)
        let type;
        const videoType = src?.split('.')[src.split('.').length-1]
        if(videoType === 'm3u8')
        type = 'application/x-mpegURL'
         else if(videoType === 'webm')
         type = 'video/webm'
         else if(videoType === 'mp4')
         type = 'video/mp4'
        else
        type = 'video/mp4'
        player.src({ src: src ,type });

        player.play();
      }
      
        document.querySelector(".play-btn").addEventListener("click", () => {
        const selectOption = document.getElementById("select-ep");

        const newSrc = selectOption.value;
       Play(newSrc)

      });
      document.querySelector(".close-btn").addEventListener("click", () => {
        document.querySelector(".heading").classList.remove("hidden");
        document.querySelector(".select-item").classList.add("hidden");
        document.querySelector(".btn-section").classList.add("hidden");
      });
      const SearchText = ()=>{
        const text = document.querySelector(".search-input").value;
        
        const filteredItems = list.filter((item) =>
          item.title.toLowerCase().includes(text.toLowerCase())
        );
        section.innerHTML = "";
        AddItem(filteredItems)
      }

      const video = document.getElementById("vid1");
      const playBtn = document.getElementById("playBtn");
      const pauseBtn = document.getElementById("pauseBtn");
      const nextBtn = document.getElementById("nextBtn");
      const prevBtn = document.getElementById("prevBtn");
      const fullS = document.getElementById("fullS");
      document.querySelector(".move10f").addEventListener("click", () => {
        player.currentTime(player.currentTime() + 10);
      });
      document.querySelector(".move10b").addEventListener("click", () => {
        player.currentTime(player.currentTime() - 10);
      });
      fullS.addEventListener("click", () => {
        if (player.isFullscreen()) {
          player.exitFullscreen();
        } else {
          player.requestFullscreen();
        }
        console.log("full screen");
      });
      // Play the video
      playBtn.addEventListener("click", () => {
        player.play();
      });

      // Pause the video
      pauseBtn.addEventListener("click", () => {
        player.pause();
      });

      // Next video (example with static URL, should use a playlist logic for real scenario)
      nextBtn.addEventListener("click", () => {
        player.pause()
        const selectOption = document.getElementById("select-ep");

        const newSrc = list.filter((el) => {
          return el.episodes.indexOf(selectOption.value) !== -1;
        })[0].episodes;

        // Get the index of the next episode
        const nextIndex = newSrc.indexOf(selectOption.value) + 1;
        const next = newSrc[nextIndex];

        // If there's no next episode, show an alert
        if (!next) {
          alert("No More Episodes");
          return;
        }

        // Update the select option's text and value
        // const nextOption = selectOption.options[selectOption.selectedIndex];
        // nextOption.text = `Episode ${nextIndex + 1}`;
        // clearSelectOptions();
        // newSrc.forEach((episode, i) => {
        //    const option = document.createElement("option");
        //       option.value = episode;
        //       option.textContent = `Episode ${i + 1}`;
        //       SelectOption.appendChild(option);
        //   });
        selectOption.selectedIndex = selectOption.selectedIndex+1;
        // Update the video player's source
        Play(next)
      });

      // Add event listener for the "Previous" button
      prevBtn.addEventListener("click", () => {
        player.pause();
    const selectOption = document.getElementById("select-ep");

    const newSrc = list.filter((el) => {
        return el.episodes.indexOf(selectOption.value) !== -1;
    })[0].episodes;

    // Get the index of the previous episode
    const prevIndex = newSrc.indexOf(selectOption.value) - 1;
    const previous = newSrc[prevIndex];

    // If there's no previous episode, show an alert
    if (prevIndex < 0) {
        alert("No Previous Episodes");
        return;
    }

    // Update the select option's text and value
    selectOption.selectedIndex = selectOption.selectedIndex - 1;

    // Update the video player's source
    Play(previous);
      });
    </script>
  </body>
</html>
